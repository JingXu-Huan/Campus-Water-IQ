# **接入层（IoT-Service）**

## 1. 接收水表 / 水质仪数据

- IoT-Service 负责接收来自水表和水质检测仪的上报数据。
- 数据接收后，需要进行基础校验，包括数据格式、必填字段以及合理性检查。
- 校验通过的数据，将发送到消息队列（推荐使用 **`RocketMQ`**），实现异步处理。

## 2. 异步写入数据库

> ⚠️ 注意：实际生产环境中，IoT 设备上报的数据频率极高，**不能一条条直接写入数据库**。

- 可采用 **缓冲 + 批量写入** 的方式，例如累积一定条数（如 1000 条）后，再批量插入 MySQL。
- 异步写入可以显著提升系统吞吐量，保证接入层快速响应设备。

## 3. 初步事件检测

- 接入层可进行简单的事件判断，例如**漏水**、**异常水质**或**设备离线**等。
- 检测到的事件可以直接上推到事件表或消息队列，供业务层和告警系统处理。
- 这种方式能够提高系统的响应速度，同时不会影响高频数据的接入。

### 数据库建表语句
参阅：IoT-emailservice/iot_device_data.sql
     IoT-emailservice/iot_device_event.sql